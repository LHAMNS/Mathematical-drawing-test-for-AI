

# 角色与目标
你是一位资深前端设计师 + WebGL/3D 可视化工程师 + 前端工程负责人。你的目标是交付一个“可直接运行、可学习、可演示、可扩展”的纯前端 3D 教育网页项目：用交互式 3D 方式完整展示“发条驱动的机械时钟（桌面机械钟）内部机构如何工作”。

这个项目必须视觉精美、结构完整、讲解严谨、动画连贯、工程规范，并且**最终以一个完整压缩包（zip）形式交付**。

> 重要：你只能输出“项目与代码交付物”，不要输出与任务无关的闲聊。所有代码必须可运行、可构建、无报错、无缺失文件。

---

# 核心交付物（必须全部提供）
1) **一个可下载/可复现的项目压缩包（zip）**  
   - 如果你所在环境支持写文件：直接生成 zip 并提供其路径/下载方式。  
   - 如果无法直接生成文件：请输出“完整项目的全部文件内容”，并额外提供**一份一键打包脚本**（例如 Node/Python/bash 三选一）让用户复制后即可在本地生成 zip。  
   - 绝对禁止只给片段、只给伪代码、只给关键文件。必须是完整项目。

2) **清晰的项目目录树**（必须与实际文件一致）

3) **可运行说明（README）**  
   - 含：环境要求、安装命令、启动命令、构建命令、常见问题排查  
   - 含：交互说明（按钮、快捷键、鼠标/触控）  
   - 含：项目结构说明（每个核心模块做什么）

4) **依赖版本核验报告（必须）**  
   - 你必须使用“搜索工具/联网查询能力”逐个核验你引入的依赖：  
     - 包名、版本号、是否存在  
     - 该版本的官方来源（官网/仓库/发布页）  
     - 兼容性要点（与构建工具、其他依赖不会冲突的理由）  
   - 你必须输出一份“版本清单 + 核验依据（链接/引用）”。  
   - 你必须使用 lockfile（例如 package-lock / pnpm-lock / yarn.lock）确保可复现安装。  
   - **禁止**：凭感觉写版本号、写不存在的版本、写可能冲突的组合、使用“latest”不锁版本。

---

# 绝对约束（不可违背）
A) **纯前端任务**  
- 不允许要求后端服务才能工作（本地 dev server 仅用于开发预览可以接受）。  
- 不允许依赖数据库/云端接口。  
- 页面必须可在现代浏览器运行。

B) **不得引用外部模型、外部贴图、外部图片资源**  
- 3D 模型：必须由你用代码“程序化生成”（procedural/parametric）。  
- 贴图/纹理：必须由你用代码生成（例如 canvas 程序纹理、噪声纹理、程序材质参数等）。  
- 禁止从网络加载任何模型文件（glb/obj/fbx 等）与任何贴图（png/jpg/hdr 等）。  
- 运行时网络请求应为 0（或仅限本地 dev server 的资源加载）；不得依赖 CDN 运行。

C) **这不是单文件项目**  
- 必须包含合理的多文件结构（src、modules、styles、assets(若有但只能放你生成的代码/字体许可等)、docs 等）。  
- 代码必须模块化。

D) **严格无错误**  
- `npm install` / `npm run dev` / `npm run build` 全程无报错（含 TypeScript/ESLint 若你使用）。  
- 浏览器控制台无报错（0 errors）。  
- 交互无明显逻辑 bug（播放/暂停/切换部件/重置等必须可靠）。

E) **机械机芯讲解必须“结构与逻辑正确”**  
- 你可以选择“典型发条机械钟的标准机构方案”（例如：发条盒/条盒 → 轮系（中心轮/三轮/四轮/擒纵轮） → 擒纵机构（锚式/叉式） → 振荡器（摆轮游丝或等效调速器） → 传动至指针（走针机构））。  
- 你必须在 README 或项目内文档中**声明你采用的具体机构假设**（例如：采用摆轮游丝；擒纵类型；是否带秒针等）。  
- 无论你选哪种方案：**齿轮啮合方向、速比关系、运动传递链路必须自洽**，且动画与公式解释要一致。

---

# 视觉与体验目标（“精美且好看”要落到可执行标准）
1) 画面风格：高质感金属、玻璃、机芯板材、螺丝与倒角的视觉暗示（允许简化但必须高级）  
2) 光照与材质：要有层次（主光、辅光、环境光/反射暗示），避免廉价塑料感  
3) 场景构图：默认视角好看，转场镜头不突兀，重点突出清晰  
4) UI：现代、克制、清晰；按钮/面板与 3D 主体不冲突；支持响应式布局  
5) 性能：桌面端目标 60fps；低端设备提供降级策略（例如降低后处理/降低细分/减少阴影）

---

# 必须实现的核心功能
## 1) 3D 机械钟整体与外壳
- 一个完整“桌面机械钟”的外观壳体（简化但要可信）：外壳/玻璃罩/底座等  
- 内部机芯：有机芯板（前/后板或框架）、支柱、螺丝等结构暗示  
- **播放讲解动画开始时**：外壳要以合理方式“拿开/打开/滑出/升起”，并在不遮挡关键部件的前提下展示内部结构  
- 外壳移除必须是动画过程（而不是瞬间消失），且在 UI 上有明确提示

## 2) 内部核心部件必须齐全并可被逐个聚焦讲解
至少包含（可按你选择的机构做合理增删，但必须解释清楚）：
- 发条与条盒（mainspring + barrel）
- 轮系（gear train）：中心轮、三轮、四轮、擒纵轮（或等效结构）
- 擒纵机构：擒纵轮与擒纵叉/锚（pallet fork/anchor）
- 振荡器：摆轮游丝（balance wheel & hairspring）或等效调速振子（但必须解释你为何这样设定）
- 走针机构（motion works）：把轮系的运动传到分针/时针（若有秒针也要合理）
- 表盘与指针：表盘刻度、时针/分针/（可选秒针）

每个部件必须具备：
- 可被 UI 选中（按钮/列表）
- 被选中时：镜头移动聚焦、部件高亮、其他部件透明化/降权
- 有对应的中英双语说明（不遮挡部件）
- 有对应的运动演示（旋转/摆动/步进等）

## 3) “自动播放讲解”动画（重点，需细化）
提供一个“Play/播放”按钮，触发一段**从头到尾的连续讲解动画**。要求如下：

### 3.1 讲解流程必须按“能量 → 传递 → 调速 → 显示”顺序组织
建议但不限定为以下段落（你可调整，但必须覆盖完整链路）：
1) 开场：整体外观 + 一句话概览（CN/EN）
2) 外壳移除：展示机芯全貌（镜头平滑推进）
3) 发条上弦与储能：演示发条卷紧、条盒输出扭矩（可视化能量储存概念）
4) 轮系传动：展示齿轮啮合、方向交替、速比变化（从条盒输出到擒纵轮）
5) 擒纵机构：展示“间歇释放能量”的步进特性（不要做成连续平滑转动而失真）
6) 振荡器：展示摆轮游丝振荡（频率与擒纵配合）
7) 走针机构：展示如何把轮系运动转换为指针（小时/分钟/秒的关系）
8) 表盘呈现：回到表盘视角，展示最终“走时效果”
9) 总结：用简短图示/要点回顾整个链路（CN/EN）

### 3.2 每段讲解必须具备“镜头 + 高亮 + 透明化 + 文本 + 动画演示”
每个讲解段落至少包含以下要素（必须在代码中结构化定义，便于维护）：
- 段落标题（中文/英文）
- 段落正文（中文/英文）
- 对应数学公式（LaTeX），可折叠显示
- 当前聚焦部件集合（一个或多个）
- 镜头目标（位置、lookAt、FOV 或等效参数）
- 镜头运动曲线（要有 easing，不可生硬）
- 该段持续时间（duration）
- 该段内部的机械演示参数（例如：齿轮角速度倍率、擒纵步进频率、慢放倍率）
- 视觉强调策略：
  - 聚焦部件：高亮描边/发光/提高对比
  - 非聚焦部件：透明度提高（更透明）、饱和度降低或变暗
  - 必须可平滑过渡（渐变而非瞬间切换）

### 3.3 播放控制必须完整
- 播放 / 暂停
- 下一段 / 上一段
- 速度调节（例如 0.25x、0.5x、1x、2x）
- 进度条/时间轴（至少显示段落进度；可选支持拖动）
- 重置到开场
- 手动模式（用户点击某个部件后，自动跳到对应段落或进入该段落的“静态讲解”）

### 3.4 文本说明不得遮挡关键部件
- 文本必须“贴近但不遮挡”：  
  - 方案：HTML overlay 锚定到 3D 世界坐标投影 + 自动避让屏幕边缘  
  - 或：固定侧边栏 + 在画面中用细线/箭头指向部件（避免遮挡）
- 在镜头移动时，文本的出现/消失要有过渡动画
- 中英双语必须同时出现，或提供一键切换（但无论如何都要支持双语）

---

# 数学公式讲解（必须）
你必须在合适的段落中加入数学公式，用于帮助理解机制。要求：
- 公式使用 LaTeX 书写，并在页面中渲染（必须离线可用）
- 每条公式旁边要有简短解释（中英）
- 公式必须与项目内的“齿轮齿数/比例/频率设定”一致，不可写成与代码参数矛盾的装饰品

必须至少覆盖的公式主题（表达方式可不同，但要有）：
- 齿轮传动速比关系（角速度与齿数/半径关系）
- 扭矩与传动关系（理想情况下的扭矩变化，及效率说明）
- 振荡器频率/周期（以你选用的振子模型为准）
- 从擒纵节拍到指针速度的换算（确保最终显示关系自洽）

---

# 工程实现与架构要求（必须工程化）
1) 项目必须采用现代前端工程化方式组织（你自行选型，但要合理）：
- 构建工具/开发服务器
- 模块化代码结构
- 清晰的状态管理（尤其是“讲解段落状态机/时间轴控制”）
- 可维护的资源生成模块（procedural geometry/material/texture）

2) 3D 生成要求：
- 所有几何体（齿轮、条盒、擒纵轮、摆轮、螺丝、板材等）必须由代码参数化生成  
- 齿轮“看起来像齿轮并能正确啮合方向与速比”，齿形可简化但不能离谱  
- 材质与纹理必须由代码生成或纯参数构成（允许使用程序噪声、渐变、简单刻线等）

3) 动画实现要求：
- 必须有清晰的“时间轴/段落驱动系统”，而不是把所有动画写成不可维护的散乱 setTimeout
- 镜头动画与部件动画解耦（相互独立但能被同一段落驱动）
- 所有动画需可暂停/恢复并保持状态一致

4) 可用性与可访问性（尽量做到）：
- 键盘可操作（至少：空格播放暂停、左右切段）
- UI 控件有 ARIA 标签
- 支持窗口 resize，画面不变形
- 支持触控基本操作（旋转/缩放/拖拽视角可选，但建议）

---

# 依赖与版本管理（必须，且必须“先核验再使用”）
- 你必须选择合适的 3D/WebGL 框架与数学公式渲染方案等依赖（例如某些成熟 3D 引擎、公式渲染库、UI/工具库等），但必须满足：
  1) 版本真实存在（通过搜索工具核验）
  2) 版本彼此兼容（给出理由与依据）
  3) 运行时不依赖 CDN（依赖必须随项目安装打包）
  4) 使用 lockfile 固定版本

- 在输出中必须包含《依赖版本核验报告》章节，格式至少包括：
  - 依赖名称
  - 固定版本号
  - 核验来源（官方发布页/文档页）
  - 选择原因（性能/生态/兼容性）
  - 潜在冲突如何避免（若有）

---

# 自检清单（你必须在交付前自我验证并在 README 写明结果）
至少包含：
- 安装依赖成功
- 开发模式可启动
- 生产构建成功
- 页面可打开且无控制台错误
- 播放讲解从头到尾可走完
- 每个部件按钮都可聚焦且文字说明正确显示
- 外壳移除动画正常
- 齿轮旋转方向与速比在演示中一致
- 数学公式渲染正常且与参数一致
- 无外部模型/贴图/图片网络请求

---

# 输出格式要求（你的最终回答必须按此顺序组织）
1) 项目概览（1~2 屏以内，说明你采用的机构假设与总体设计）
2) 目录树（必须）
3) 依赖版本核验报告（必须，含来源依据）
4) 逐文件输出完整内容（按目录树顺序逐个给出，每个文件必须完整）
5) 打包方式：
   - 如果你能直接生成 zip：给出 zip 获取方式
   - 否则：给出一键打包脚本 + 使用说明，确保用户复制粘贴就能生成 zip
6) 运行与构建说明（README 已包含则在此指向即可）

---

# 额外加分（在不破坏约束的前提下尽量实现）
- “X-Ray/透视模式”：一键把非聚焦部件半透明
- “爆炸视图”：将部件沿法向/径向略微分离，便于观察
- “剖切面/裁剪平面”：展示机芯内部层级
- “标注层”：可开关的部件名称标注（CN/EN）
- “慢放/单步”：擒纵机构可切到单步演示

---

# 最终提醒（硬性）
- 不要输出占位符、TODO、伪代码。
- 不要引用外部模型/贴图/图片。
- 不要编造依赖版本；必须核验。
- 不要让项目报错；必须可运行。
- 这是一个完整教育工具：讲解要“详细、分段、双语、可跟随镜头”，且机械链路必须自洽。
